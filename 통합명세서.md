# 프로젝트 통합 문서: 소비재판소 (Shopping Court) 

## 0. 중요 숙지내용
* **플랫폼** : 본 서비스는 **'앱인토스'**에 출시될 예정입니다.
* **준수 사항** : 개발의 모든 단계에서 **'앱인토스 개발자 센터'**에 공시된 가이드라인을 무조건적으로 따르며, 해당 플랫폼의 특수성을 반영하여 아키텍처 및 UI/UX를 설계해야 합니다.

## 1. 서비스 개요 및 핵심 컨셉
* **한 줄 설명**: 사용자가 자신의 소비 계획을 게시하면, 다른 사용자들이 투표와 댓글을 통해 해당 소비가 합리적인지 판결하는 커뮤니티 서비스입니다.
* **주요 흐름**: 닉네임 생성 → 게시글 탐색 및 상세 진입 → 투표 참여 → 댓글 작성 및 토론 → 48시간 후 판결 확정 및 결과 열람 → **판사봉 획득 및 포인트 교환**.

## 2. 사용자 및 커뮤니티 규칙
* **닉네임 시스템**: 실명 없이 활동하며, 중복 시 숫자가 자동으로 부여됩니다 (예: 사용자1, 사용자2). 생성 이후 변경은 불가능 합니다.
* **게시글 작성**: 제목과 설명을 필수로 작성하며, 연령대, 현재 상황, 직업, 소비 대상, 가격을 포함하도록 가이드라인이 상시 노출됩니다.
* **투표 및 댓글 규칙**:
    * 투표 항목은 '합리적이다(무죄)'와 '비합리적이다(유죄)' 두 가지이며, 게시글당 1회만 가능합니다.
    * 투표 완료 후에는 선택을 변경할 수 없습니다.
    * **투표 후 댓글 작성**: 투표를 마친 사용자만 댓글을 쓸 수 있으며, 댓글에는 작성자의 투표 결과가 함께 표시됩니다.
    * 좋아요 기능만 제공하며 싫어요 기능은 없습니다.

## 3. 핵심 비즈니스 로직 및 시스템 설계
* **판결 확정 시스템**:
    * 게시글은 작성 시점부터 48시간 동안만 활성 상태를 유지합니다.
    * 48시간 경과 시 자동으로 '판결 완료' 상태로 전환되며, 투표와 댓글 작성이 비활성화됩니다.
    * 판결 결과는 다수결에 따라 유죄/무죄/판결 보류(동률 시)로 결정되며 도장 형태로 표시됩니다.
* **인기 게시글(실시간 인기 투표)**:
    * **산정 공식**: `판단 지표 = 투표 수 + (댓글 수 × 2)`.
    * 동일 사용자의 댓글은 점수 산정 시 1개만 반영됩니다.
    * 지표가 높은 글은 홈 화면 상단 '실시간 인기 투표(화제의 재판)' 영역에 노출됩니다.

### **[핵심] 보상 시스템 (판사봉 & 토스 포인트)**
* **재화 단위**: 서비스 내 활동 보상으로 **'판사봉'**을 지급합니다.
* **교환 비율**: **판사봉 50개 = 토스 포인트 5원** (교환 신청 시 토스 API 호출하여 즉시 지급).
* **미션 구조 (Level System)**:
    * **Level 0 (첫 이벤트)**:
        * **조건**: 투표 1회 + 댓글 1회 + 게시글 1회 작성 완료 (누적 기준).
        * **보상**: 판사봉 100개.
        * **주기**: **계정당 1회 한정** (가입 후 초기 정착 유도).
    * **Level 1 (초보 미션)**:
        * **조건**: 투표 5회 참여 (일일 기준).
        * **보상**: 판사봉 30개.
        * **주기**: **매일 1회** (매일 자정 초기화).
    * **Level 2 (참여 미션)**:
        * **조건**: 댓글 3회 작성 (일일 기준).
        * **보상**: 판사봉 60개.
        * **주기**: **매일 1회** (매일 자정 초기화).
    * **Level 3 (핵심 기여)**:
        * **조건**: 본인이 작성한 게시글이 '화제의 재판(실시간 인기)'에 등재.
        * **보상**: 판사봉 100개.
        * **주기**: **게시물당 1회** (중복 지급 허용).
        * **상세 로직**: 동일 작가가 여러 게시물을 화제글에 올려도 각각 보상 지급. 단, **하나의 게시물**이 순위 등락을 반복하여 여러 번 보상받는 것은 방지(게시물 내 플래그 체크).

* **일일 초기화 로직 (Lazy Reset)**:
    * 별도의 서버 스케줄러(Cron)를 사용하지 않습니다.
    * 사용자가 **활동(투표/댓글)**을 하거나 **미션 페이지에 진입**하는 시점에 DB의 `lastActiveDate`를 확인합니다.
    * 날짜가 지났으면 `dailyStats` 필드를 0으로 초기화하고, `isClaimed` 플래그를 false로 변경합니다.

## 4. 기술 스택 (Tech Stack)
* **Frontend**: React, Vite, TypeScript, Toss Design System(TDS).
* **Backend & DB**: Firebase (Serverless), Firestore(NoSQL).
* **인증 및 스토리지**: Firebase Authentication, Firebase Storage.
* **서버 로직**: Cloud Functions (투표 마감, 통계 업데이트, 화제글 선정 및 보상 트리거).

## 5. 데이터 구조 (Firestore) [Revised]

### **users (사용자 정보 및 미션 상태)**
* **기본 정보**
    * `userId` (String): PK
    * `nickname` (String)
* **재화 정보**
    * `currentGavels` (Number): 현재 보유 판사봉 (기본값 0)
    * `totalExchangedPoints` (Number): 누적 교환 포인트 (통계용)
* **누적 통계 (Level 0 판단용)**
    * `totalStats` (Map):
        * `postCount` (Number): 누적 게시글 수
        * `voteCount` (Number): 누적 투표 수
        * `commentCount` (Number): 누적 댓글 수
    * `isLevel0Claimed` (Boolean): Level 0 보상 수령 여부
* **일일 활동 통계 (Level 1, 2 판단용)**
    * `dailyStats` (Map):
        * `lastActiveDate` (String): "YYYY-MM-DD" (초기화 기준)
        * `voteCount` (Number): 오늘의 투표 수
        * `commentCount` (Number): 오늘의 댓글 수
        * `isLevel1Claimed` (Boolean): 오늘 Level 1 보상 수령 여부
        * `isLevel2Claimed` (Boolean): 오늘 Level 2 보상 수령 여부

### **cases (게시글 정보)**
* `caseId` (String): PK
* `authorId` (String): 작성자 ID
* `title` (String), `content` (String), `images[]` (Array)
* `guiltyCount` (Number), `innocentCount` (Number)
* `voteEndAt` (Timestamp): 마감 시간
* `status` (String): "OPEN" | "CLOSED"
* `hotScore` (Number): 인기 지수
* `isHotListed` (Boolean): 화제의 재판 등재 및 **보상 지급 완료 여부**
    * `false`: 미등재 또는 보상 미지급.
    * `true`: 등재됨 & 작성자에게 Level 3 보상 지급 완료 (중복 지급 방지용).
* `createdAt` (Timestamp)

### **votes (투표 내역)**
* `caseId_userId` (String): PK (중복 투표 방지)
* `caseId` (String), `userId` (String)
* `voteType` (String): "GUILTY" | "INNOCENT"

### **comments (댓글 내역)**
* `caseId` (String), `commentId` (String)
* `content` (String)
* `likes` (Number)
* `likedBy` (Array): 좋아요 누른 유저 ID 목록 (중복 방지)